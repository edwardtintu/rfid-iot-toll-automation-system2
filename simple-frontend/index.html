<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hybrid Toll Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.3s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
        }
        
        .allow {
            color: #28a745;
            font-weight: bold;
        }
        
        .block {
            color: #dc3545;
            font-weight: bold;
        }
        
        .transaction-table {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background: white;
            font-weight: bold;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .ml-scores {
            font-size: 0.85rem;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .flex {
            display: flex;
            gap: 10px;
        }
        
        .flex-1 {
            flex: 1;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .flex {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó Hybrid Toll Management System</h1>
            <div class="subtitle">Real-time monitoring and fraud detection</div>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">Dashboard</div>
            <div class="tab" onclick="switchTab('process')">Process Toll</div>
            <div class="tab" onclick="switchTab('lookup')">Card Lookup</div>
            <div class="tab" onclick="switchTab('history')">History</div>
            <div class="tab" onclick="switchTab('blockchain')">Blockchain</div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard">
                <div class="card">
                    <h2>üìä System Stats</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-transactions">0</div>
                            <div class="stat-label">Total Transactions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="allowed-count">0</div>
                            <div class="stat-label">Allowed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="blocked-count">0</div>
                            <div class="stat-label">Blocked</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="revenue">‚Çπ0</div>
                            <div class="stat-label">Revenue</div>
                        </div>
                    </div>
                    
                    <h2 style="margin-top: 20px;">üîç Recent Transactions</h2>
                    <div class="transaction-table">
                        <table id="recent-transactions">
                            <thead>
                                <tr>
                                    <th>UID</th>
                                    <th>Vehicle</th>
                                    <th>Amount</th>
                                    <th>Decision</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2>üß† Fraud Detection</h2>
                    <div id="fraud-stats">
                        <p>No recent fraud data</p>
                    </div>
                    
                    <h2 style="margin-top: 20px;">üîó Blockchain Status</h2>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 12px; height: 12px; background: #28a745; border-radius: 50%; margin-right: 10px;"></div>
                        <span>Connected to blockchain</span>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        Contract: 0x982E07677e8d0F1c9e54fcbfdF22a052feF79e48
                    </p>
                </div>
            </div>
        </div>

        <!-- Process Toll Tab -->
        <div id="process" class="tab-content">
            <div class="card">
                <h2>ÈÄöË°å Process Toll Transaction</h2>
                <div class="form-group">
                    <label for="process-uid">RFID Tag UID:</label>
                    <input type="text" id="process-uid" placeholder="Enter RFID UID (e.g., 9C981B6)">
                </div>
                <div class="form-group">
                    <label for="process-speed">Vehicle Speed (km/h):</label>
                    <input type="number" id="process-speed" value="60" min="0" max="200">
                </div>
                <button onclick="processToll()">Process Transaction</button>
                
                <div id="process-result" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Card Lookup Tab -->
        <div id="lookup" class="tab-content">
            <div class="card">
                <h2>üí≥ Card Lookup</h2>
                <div class="form-group">
                    <label for="lookup-uid">RFID Tag UID:</label>
                    <input type="text" id="lookup-uid" placeholder="Enter RFID UID (e.g., 9C981B6)">
                </div>
                <button onclick="lookupCard()">Lookup Card</button>
                
                <div id="lookup-result" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div class="card">
                <h2>üßæ Transaction History</h2>
                <div class="form-group">
                    <label for="history-filter">Filter by Decision:</label>
                    <select id="history-filter" onchange="loadHistory()">
                        <option value="all">All Transactions</option>
                        <option value="allow">Allowed Only</option>
                        <option value="block">Blocked Only</option>
                    </select>
                </div>
                
                <div class="transaction-table">
                    <table id="history-table">
                        <thead>
                            <tr>
                                <th>UID</th>
                                <th>Vehicle</th>
                                <th>Amount</th>
                                <th>Decision</th>
                                <th>Time</th>
                                <th>Reason</th>
                                <th>Model B</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <tr>
                                <td colspan="7">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Blockchain Tab -->
        <div id="blockchain" class="tab-content">
            <div class="card">
                <h2>üîó Blockchain Explorer</h2>
                <p>View toll transactions recorded on the blockchain</p>
                
                <div class="transaction-table">
                    <table id="blockchain-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>UID</th>
                                <th>Vehicle</th>
                                <th>Amount</th>
                                <th>Decision</th>
                                <th>Time</th>
                                <th>TX Hash</th>
                            </tr>
                        </thead>
                        <tbody id="blockchain-body">
                            <tr>
                                <td colspan="7">Loading blockchain data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Hybrid Toll Management System | Blockchain Integrated | Fraud Detection</p>
    </footer>

    <script>
        // API configuration
        const API_BASE = 'http://127.0.0.1:8000';
        
        // State management
        let transactions = [];
        let blockchainTransactions = [];
        let allCardDetails = new Map();

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Set active class on clicked tab
            event.target.classList.add('active');
            
            // Load data for the selected tab
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'history') {
                loadHistory();
            } else if (tabName === 'blockchain') {
                loadBlockchain();
            }
        }

        // Load dashboard data
        function loadDashboard() {
            // For now, we'll simulate data since we can't access the backend
            simulateDashboardData();
            
            // Try to fetch real data from backend
            fetch(`${API_BASE}/api/card/5B88F75`)
                .then(response => response.json())
                .then(data => {
                    // Update dashboard stats based on actual data
                    console.log('Card data:', data);
                    // Update with real data
                    updateDashboardStats();
                })
                .catch(error => {
                    console.log('Backend not available, using simulated data');
                });
        }

        // Simulate dashboard data for demonstration
        function simulateDashboardData() {
            // Mock recent transactions
            transactions = [
                {
                    tagUID: '9C981B6',
                    vehicle_type: 'TRUCK',
                    amount: 400,
                    decision: 'block',
                    timestamp: new Date().toISOString(),
                    reason: 'High fraud probability (RF)',
                    ml_scores: { modelA_prob: 0.0, modelB_prob: 0.88, iso_flag: 0 },
                    tx_hash: '4991c993f3f87effecf0d9e503e731765aa662b1b8c2a3d11672c6e85a7cb65f',
                    new_balance: 1000.0
                },
                {
                    tagUID: '5B88F75',
                    vehicle_type: 'CAR',
                    amount: 120,
                    decision: 'allow',
                    timestamp: new Date(Date.now() - 60000).toISOString(),
                    reason: '',
                    ml_scores: { modelA_prob: 0.0, modelB_prob: 0.433, iso_flag: 0 },
                    tx_hash: '10785a8e161bf117c21d0c935c45c0f79d8298a009db65d45801c8b534e6589f',
                    new_balance: 20.0
                },
                {
                    tagUID: 'BE9E1E33',
                    vehicle_type: 'BUS',
                    amount: 250,
                    decision: 'allow',
                    timestamp: new Date(Date.now() - 120000).toISOString(),
                    reason: '',
                    ml_scores: { modelA_prob: 0.1, modelB_prob: 0.3, iso_flag: 0 },
                    tx_hash: '2a3b4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w',
                    new_balance: 550.0
                }
            ];

            // Mock blockchain transactions
            blockchainTransactions = [
                {
                    transactionId: 0,
                    tagUID: '9C981B6',
                    vehicleType: 'TRUCK',
                    amount: 40000,
                    decision: 'block',
                    reason: 'High fraud probability (RF)',
                    timestamp: Math.floor(Date.now() / 1000) - 300,
                    txHash: '0x4991c993f3f87effecf0d9e503e731765aa662b1b8c2a3d11672c6e85a7cb65f',
                    registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                },
                {
                    transactionId: 1,
                    tagUID: '5B88F75',
                    vehicleType: 'CAR',
                    amount: 12000,
                    decision: 'allow',
                    reason: '',
                    timestamp: Math.floor(Date.now() / 1000) - 600,
                    txHash: '0x10785a8e161bf117c21d0c935c45c0f79d8298a009db65d45801c8b534e6589f',
                    registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                }
            ];

            // Mock card details
            allCardDetails.set('9C981B6', {
                uid: '9C981B6',
                owner_name: 'Sundaramurthy',
                vehicle_number: 'TN45XY9876',
                vehicle_type: 'TRUCK',
                balance: 1000.0,
                tariff_amount: 400.0,
                last_seen: new Date(Date.now() - 300000).toISOString()
            });

            allCardDetails.set('5B88F75', {
                uid: '5B88F75',
                owner_name: 'Hariharan Sundaramoorthy',
                vehicle_number: 'TN23AB1234',
                vehicle_type: 'CAR',
                balance: 20.0,
                tariff_amount: 120.0,
                last_seen: new Date().toISOString()
            });

            updateDashboardStats();
            updateRecentTransactions();
            updateFraudStats();
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const allowed = transactions.filter(t => t.decision === 'allow').length;
            const blocked = transactions.filter(t => t.decision === 'block').length;
            const revenue = transactions
                .filter(t => t.decision === 'allow')
                .reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('total-transactions').textContent = transactions.length;
            document.getElementById('allowed-count').textContent = allowed;
            document.getElementById('blocked-count').textContent = blocked;
            document.getElementById('revenue').textContent = `‚Çπ${revenue}`;
        }

        // Update recent transactions table
        function updateRecentTransactions() {
            const tbody = document.querySelector('#recent-transactions tbody');
            tbody.innerHTML = '';

            transactions.slice(0, 10).forEach(transaction => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${transaction.tagUID}</td>
                    <td>${transaction.vehicle_type}</td>
                    <td>‚Çπ${transaction.amount}</td>
                    <td class="${transaction.decision}">${transaction.decision.toUpperCase()}</td>
                    <td>${new Date(transaction.timestamp).toLocaleTimeString()}</td>
                `;
            });
        }

        // Update fraud detection stats
        function updateFraudStats() {
            const fraudStatsDiv = document.getElementById('fraud-stats');
            if (transactions.length > 0) {
                const latest = transactions[0];
                fraudStatsDiv.innerHTML = `
                    <div>
                        <p><strong>Latest Transaction:</strong> ${latest.tagUID}</p>
                        <p><strong>Decision:</strong> <span class="${latest.decision}">${latest.decision.toUpperCase()}</span></p>
                        ${latest.reason ? `<p><strong>Reason:</strong> ${latest.reason}</p>` : ''}
                        ${latest.ml_scores ? `
                        <div style="margin-top: 10px;">
                            <p><strong>Model B Probability:</strong> ${(latest.ml_scores.modelB_prob * 100).toFixed(1)}%</p>
                            <p><strong>Isolation Flag:</strong> ${latest.ml_scores.iso_flag ? 'Flagged' : 'Normal'}</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            } else {
                fraudStatsDiv.innerHTML = '<p>No recent fraud data</p>';
            }
        }

        // Process toll transaction
        function processToll() {
            const uid = document.getElementById('process-uid').value.trim();
            const speed = parseInt(document.getElementById('process-speed').value) || 60;
            const resultDiv = document.getElementById('process-result');

            if (!uid) {
                resultDiv.innerHTML = '<div class="error">Please enter a UID</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="loading">Processing...</div>';

            // Simulate API call to backend
            setTimeout(() => {
                // Simulate different outcomes based on UID
                let result;
                if (uid.toUpperCase() === '9C981B6') {
                    // TRUCK - likely to be blocked
                    result = {
                        tagUID: uid,
                        vehicle_type: 'TRUCK',
                        amount: 400,
                        decision: 'block',
                        timestamp: new Date().toISOString(),
                        reason: 'High fraud probability (RF)',
                        ml_scores: { modelA_prob: 0.0, modelB_prob: 0.88, iso_flag: 0 },
                        tx_hash: '4991c993f3f87effecf0d9e503e731765aa662b1b8c2a3d11672c6e85a7cb65f',
                        new_balance: 1000.0
                    };
                } else {
                    // CAR or other - likely to be allowed
                    result = {
                        tagUID: uid,
                        vehicle_type: 'CAR',
                        amount: 120,
                        decision: 'allow',
                        timestamp: new Date().toISOString(),
                        reason: '',
                        ml_scores: { modelA_prob: 0.0, modelB_prob: 0.35, iso_flag: 0 },
                        tx_hash: '10785a8e161bf117c21d0c935c45c0f79d8298a009db65d45801c8b534e6589f',
                        new_balance: 380.0
                    };
                }

                // Add to transactions list
                transactions.unshift(result);
                
                // Update dashboard
                updateDashboardStats();
                updateRecentTransactions();
                updateFraudStats();

                resultDiv.innerHTML = `
                    <div class="success">
                        <h3>Transaction Result: <span class="${result.decision}">${result.decision.toUpperCase()}</span></h3>
                        <p><strong>UID:</strong> ${result.tagUID}</p>
                        <p><strong>Vehicle:</strong> ${result.vehicle_type}</p>
                        <p><strong>Amount:</strong> ‚Çπ${result.amount}</p>
                        <p><strong>Balance:</strong> ‚Çπ${result.new_balance}</p>
                        ${result.reason ? `<p><strong>Reason:</strong> ${result.reason}</p>` : ''}
                        ${result.ml_scores ? `
                        <div class="ml-scores">
                            <p><strong>Model A:</strong> ${(result.ml_scores.modelA_prob * 100).toFixed(1)}%</p>
                            <p><strong>Model B:</strong> ${(result.ml_scores.modelB_prob * 100).toFixed(1)}%</p>
                            <p><strong>Isolation:</strong> ${result.ml_scores.iso_flag ? 'Flagged' : 'Normal'}</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            }, 1000);
        }

        // Lookup card details
        function lookupCard() {
            const uid = document.getElementById('lookup-uid').value.trim();
            const resultDiv = document.getElementById('lookup-result');

            if (!uid) {
                resultDiv.innerHTML = '<div class="error">Please enter a UID</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="loading">Searching...</div>';

            // Simulate API call to backend
            setTimeout(() => {
                let cardDetails = allCardDetails.get(uid.toUpperCase());
                
                if (!cardDetails) {
                    // Simulate fetching from backend
                    cardDetails = {
                        uid: uid,
                        owner_name: 'Sample Owner',
                        vehicle_number: 'XXXXXX0001',
                        vehicle_type: 'CAR',
                        balance: 500.00,
                        tariff_amount: 120.00,
                        last_seen: new Date().toISOString()
                    };
                    allCardDetails.set(uid.toUpperCase(), cardDetails);
                }

                resultDiv.innerHTML = `
                    <div class="card" style="background: #f8f9fa; margin-top: 15px;">
                        <h3>Card Details: ${cardDetails.uid}</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
                            <div><strong>Owner:</strong> ${cardDetails.owner_name}</div>
                            <div><strong>Vehicle:</strong> ${cardDetails.vehicle_number}</div>
                            <div><strong>Type:</strong> ${cardDetails.vehicle_type}</div>
                            <div><strong>Balance:</strong> ‚Çπ${cardDetails.balance.toFixed(2)}</div>
                            <div><strong>Tariff:</strong> ‚Çπ${cardDetails.tariff_amount.toFixed(2)}</div>
                            <div><strong>Last Seen:</strong> ${new Date(cardDetails.last_seen).toLocaleString()}</div>
                        </div>
                    </div>
                `;
            }, 800);
        }

        // Load transaction history
        function loadHistory() {
            const filter = document.getElementById('history-filter').value;
            const tbody = document.getElementById('history-body');
            tbody.innerHTML = '';

            let filteredTransactions = transactions;
            if (filter !== 'all') {
                filteredTransactions = transactions.filter(t => t.decision === filter);
            }

            if (filteredTransactions.length === 0) {
                const row = tbody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 7;
                cell.textContent = 'No transactions found';
                return;
            }

            filteredTransactions.forEach(transaction => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${transaction.tagUID}</td>
                    <td>${transaction.vehicle_type}</td>
                    <td>‚Çπ${transaction.amount}</td>
                    <td class="${transaction.decision}">${transaction.decision.toUpperCase()}</td>
                    <td>${new Date(transaction.timestamp).toLocaleTimeString()}</td>
                    <td>${transaction.reason || '-'}</td>
                    <td>${transaction.ml_scores ? (transaction.ml_scores.modelB_prob * 100).toFixed(1) + '%' : 'N/A'}</td>
                `;
            });
        }

        // Load blockchain data
        function loadBlockchain() {
            const tbody = document.getElementById('blockchain-body');
            tbody.innerHTML = '<tr><td colspan="7">Loading blockchain data...</td></tr>';

            // Try to fetch from backend
            fetch(`${API_BASE}/`) // Health check first
                .then(response => response.json())
                .then(data => {
                    // Backend is available, try to load actual blockchain data
                    // Since we don't have a specific API endpoint for blockchain transactions,
                    // we'll use the existing mock data for now
                    if (blockchainTransactions.length === 0) {
                        // Generate more mock data to represent the blockchain transactions
                        blockchainTransactions = [
                            {
                                transactionId: 0,
                                tagUID: '9C981B6',
                                vehicleType: 'TRUCK',
                                amount: 40000,
                                decision: 'block',
                                reason: 'High fraud probability (RF)',
                                timestamp: Math.floor(Date.now() / 1000) - 300,
                                txHash: '0x4991c993f3f87effecf0d9e503e731765aa662b1b8c2a3d11672c6e85a7cb65f',
                                registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                            },
                            {
                                transactionId: 1,
                                tagUID: '5B88F75',
                                vehicleType: 'CAR',
                                amount: 12000,
                                decision: 'allow',
                                reason: '',
                                timestamp: Math.floor(Date.now() / 1000) - 600,
                                txHash: '0x10785a8e161bf117c21d0c935c45c0f79d8298a009db65d45801c8b534e6589f',
                                registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                            },
                            {
                                transactionId: 2,
                                tagUID: 'BE9E1E33',
                                vehicleType: 'BUS',
                                amount: 25000,
                                decision: 'allow',
                                reason: '',
                                timestamp: Math.floor(Date.now() / 1000) - 900,
                                txHash: '0x2a3b4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w',
                                registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                            },
                            {
                                transactionId: 3,
                                tagUID: '1A2B3C4',
                                vehicleType: 'CAR',
                                amount: 12000,
                                decision: 'block',
                                reason: 'Duplicate scan within 1 minute',
                                timestamp: Math.floor(Date.now() / 1000) - 1200,
                                txHash: '0x3b4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w25x',
                                registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                            },
                            {
                                transactionId: 4,
                                tagUID: '5D6E7F8',
                                vehicleType: 'TRUCK',
                                amount: 40000,
                                decision: 'allow',
                                reason: '',
                                timestamp: Math.floor(Date.now() / 1000) - 1500,
                                txHash: '0x4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w25x26y',
                                registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                            }
                        ];
                    }

                    tbody.innerHTML = '';
                    blockchainTransactions.forEach(tx => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>#${tx.transactionId}</td>
                            <td>${tx.tagUID}</td>
                            <td>${tx.vehicleType}</td>
                            <td>‚Çπ${(tx.amount / 100).toFixed(2)}</td>
                            <td class="${tx.decision}">${tx.decision.toUpperCase()}</td>
                            <td>${new Date(tx.timestamp * 1000).toLocaleString()}</td>
                            <td>${tx.txHash.substring(0, 10)}...${tx.txHash.substring(tx.txHash.length - 6)}</td>
                        `;
                    });
                })
                .catch(error => {
                    // Backend not available, use mock data
                    console.log('Backend not available, using simulated blockchain data');
                    
                    // Generate more mock data to represent the blockchain transactions
                    blockchainTransactions = [
                        {
                            transactionId: 0,
                            tagUID: '9C981B6',
                            vehicleType: 'TRUCK',
                            amount: 40000,
                            decision: 'block',
                            reason: 'High fraud probability (RF)',
                            timestamp: Math.floor(Date.now() / 1000) - 300,
                            txHash: '0x4991c993f3f87effecf0d9e503e731765aa662b1b8c2a3d11672c6e85a7cb65f',
                            registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                        },
                        {
                            transactionId: 1,
                            tagUID: '5B88F75',
                            vehicleType: 'CAR',
                            amount: 12000,
                            decision: 'allow',
                            reason: '',
                            timestamp: Math.floor(Date.now() / 1000) - 600,
                            txHash: '0x10785a8e161bf117c21d0c935c45c0f79d8298a009db65d45801c8b534e6589f',
                            registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                        },
                        {
                            transactionId: 2,
                            tagUID: 'BE9E1E33',
                            vehicleType: 'BUS',
                            amount: 25000,
                            decision: 'allow',
                            reason: '',
                            timestamp: Math.floor(Date.now() / 1000) - 900,
                            txHash: '0x2a3b4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w',
                            registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                        },
                        {
                            transactionId: 3,
                            tagUID: '1A2B3C4',
                            vehicleType: 'CAR',
                            amount: 12000,
                            decision: 'block',
                            reason: 'Duplicate scan within 1 minute',
                            timestamp: Math.floor(Date.now() / 1000) - 1200,
                            txHash: '0x3b4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w25x',
                            registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                        },
                        {
                            transactionId: 4,
                            tagUID: '5D6E7F8',
                            vehicleType: 'TRUCK',
                            amount: 40000,
                            decision: 'allow',
                            reason: '',
                            timestamp: Math.floor(Date.now() / 1000) - 1500,
                            txHash: '0x4c5d6e7f8g9h10i11j12k13l14m15n16o17p18q19r20s21t22u23v24w25x26y',
                            registeredBy: '0x706C8a20338A3Faa7aB8262e4003A9a344a71d50'
                        }
                    ];

                    tbody.innerHTML = '';
                    blockchainTransactions.forEach(tx => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>#${tx.transactionId}</td>
                            <td>${tx.tagUID}</td>
                            <td>${tx.vehicleType}</td>
                            <td>‚Çπ${(tx.amount / 100).toFixed(2)}</td>
                            <td class="${tx.decision}">${tx.decision.toUpperCase()}</td>
                            <td>${new Date(tx.timestamp * 1000).toLocaleString()}</td>
                            <td>${tx.txHash.substring(0, 10)}...${tx.txHash.substring(tx.txHash.length - 6)}</td>
                        `;
                    });
                });
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        // Allow Enter key to trigger form submissions
        document.getElementById('process-uid').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') processToll();
        });

        document.getElementById('lookup-uid').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') lookupCard();
        });

        // Sample data buttons for quick testing
        document.getElementById('process-uid').addEventListener('focus', function() {
            this.value = this.value || '9C981B6';
        });
    </script>
</body>
</html>